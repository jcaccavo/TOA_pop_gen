# TOA_pop_gen
This repository contains data files and scripts used for 3RADseq and WGR data analysis from the paper Caccavo et al. 2026a "Whole-genome resequencing reveals exceptions to panmixia in the exploited top fish predator Antarctic toothfish (Dissostichus mawsoni)".

## 3RADseq
Scripts and files required for the analysis of high-output sequencing data produced using 3RADseq.

### Preprocessing
- **01_fastqc.sh**: bash script to check reads quality using fastqc. Output can then be compiled using multiqc.
- **02_AdapterTrimming.sh**: bash script to remove sequencing adapters.
- **02a_AdapterTrimming.sh**: alternative bash script to remove sequencing adapters. In this alternative script, the adapter sequence is adjusted for the Illumina Universal Adapter script, as opposed to the Nextera Transposase Sequence.
- **03_Demultiplexing.sh**: bash script for demultiplexing. Should be run in a flexbar conda environment.
- **Internal_indexes_LIB_P5**: P5 internal indexes (referred to in 03_Demultiplexing.sh).
- **Internal_indexes_LIB_P7**: P7 internal indexes (referred to in 03_Demultiplexing.sh).
- **04_Rename.sh**: bash script to rename demultiplexed files. Demultiplexing will have produced a lot of files, i.e., 2 reads x number of library pools x number of barcode combinations. Prepare renaming script using Excel following RenameIndividuals.xlsx example, and then replace the contents of the script uploaded here with your relevant input.
- **RenameIndividuals.xlsx**: Excel file to prepare renaming script.
- **05_PCRduplicatesFilter.sh**: bash script to filter PCR duplicates.
- **filterPCRdups.py**: python script to filter PCR duplicates (referred to in 05_PCRduplicatesFilter.sh).
- **06_Concatenate_all.sh**: bash script to concatenate the 4 replicates per individual.
- **07_mapping.sh**: bash script to map concatenated reads to the _D. mawsoni_ reference genome (read 1 only). The _D. mawsoni_ reference genome is available from GenBank accession number [JAAKFY000000000](https://www.ncbi.nlm.nih.gov/nuccore/JAAKFY000000000).
- **getInsertSizefromSAM.sh**: bash script to determine the read length distribution from mapping (.sam) files.
- **getInsertSizefromSAM.py**: python script to determine the read length distribution from mapping (.sam) files (referred to in getInsertSizefromSAM.sh).
- **plotFragSizes_args_fastq.R**: R script to plot read length distributions based on the output from getInsertSizefromSAM.py (referred to in getInsertSizefromSAM.sh).
- **08_merging.sh**: bash script to merge pair-end reads using [PEAR](https://cme.h-its.org/exelixis/web/software/pear/doc.html). Based on length distributions, modify the following script parameters (the rest remain unchanged): 1) **-n – 30**: specifies the minimum possible length of the assembled sequences. Setting this value to 0 disables the restriction and assembled sequences may be arbitrarily short (default: 50); 2) **-m – 310**: specifies the maximum possible length of the assembled sequences. Setting this value to 0 disables the restriction and assembled sequences may be arbitrarily long (default: 3); **-v – 10**: specifies the minimum overlap size. The minimum overlap may be set to 1 when the statistical test is used. However, further restricting the minimum overlap size to a proper value may reduce false-positive assembles (default: 10).
- **09_CorrectOrientation.sh**: The files to continue with are the *.unassembled.forward.fastq and *.unassembled.reverse.fastq. After using merging with [PEAR](https://cme.h-its.org/exelixis/web/software/pear/doc.html), R2 is inverted. This bash script corrects the orientation of R2.
- **SeqIO_reverseComplement.py**: python script to to correct the orientation of R2 (referred to in 09_CorrectOrientation.sh).
- **10_QualityFilter.sh**: bash script to remove low quality reads using [Trimmomatic](https://doi.org/10.1093/bioinformatics/btu170).
- **11_CheckRestSites.sh**: remove reads that don’t start and end with the correct restriction sites. Assure that the correct restriction enzyme sequences are indicated: XbaI **CTAGA**; EcoRI **AATTC**; MspI **CGG**.
- **12a_EditHeaders.sh**: first in a set of three bash scripts to remove undigested reads. This first script edits the file headers.
- **12b_SaveHeaders.sh**: second in a set of three bash scripts to remove undigested reads. This second script saves the headers of reads with intact restriction sites. Assure that the correct restriction enzyme sequences are indicated; note that these sequence indications include the base pair before the cut site. The first restriction site sequence is for the 1st enzyme (start) (e.g., XbaI or MspI). The second restriction site sequence is for the 3rd enzyme (middle) (e.g., ClaI or NheI). The third rescrition site sequence is for the 2nd enzyme (end, EcoRI). **XbaI** TCTAGA; **EcoRI** GAATTC; **MspI** CCGG; **ClaI** ATCGAT; **NheI** GCTAGC.
- **12c_3enzymesFilter.sh**: this in a set of three bash script to remove undigested reads. This third script filters out the reads indicated in the list created in the previous script.
- **Filter_reads.py**: python script to remove undigested read (referred to in 12c_3enzymesFilter.sh).
- **13_final_fastqc.sh**: bash script to check reads quality using fastqc after all pre-processing steps. Output can then be compiled using multiqc.
- **14_final_mapping.sh**: bash script to map fully pre-processed reads to the _D. mawsoni_ reference genome. The _D. mawsoni_ reference genome is available from GenBank accession number [JAAKFY000000000](https://www.ncbi.nlm.nih.gov/nuccore/JAAKFY000000000).
- **15_convert_sam_to_bam.sh**: bash script employing [samtools view](https://www.htslib.org/doc/samtools-view.html) to convert .sam files generated from mapping to .bam files.
- **16_sort_bam.sh**: bash script employing [samtools sort](https://www.htslib.org/doc/samtools-sort.html) to sort .bam files.
- **coverage.sh**: bash script employing [samtools depth](https://www.htslib.org/doc/samtools-depth.html) to check post-preprocessing coverage of each library.
  
### SNP calling
- **Create popmap file(s)**: create as many popmap files as potential population configurations. This can be done in Excel, saving each popmap sheet as tab-delimited text file (.txt). Column 1 of the popmap file must contain the individual sample names EXACTLY as they are written for the .bam files. Column 2 contains the population number to which the individual belongs (e.g. 1, 2, 5, etc.).
- **popmap.txt**: example popmap file.
- **17_Stacks.sh**: bash script to run [STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php). **inPath**: location of the .bam files which represent the reads mapped to the genome (only the .bam files to be processed should be in the input folder). **outPath**: where you want to save the output files. **popmap**: the location of the popmap file to be used. **Refmap**: the location of the Refmap file, which is a [STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php) file. This is either located in the directory where [STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php) downloaded, or you can copy the file to your scripts folder. **PREFIX**: how you want the output files to be labelled. This should be based on your popmap file name. Each $Refmap run refers to a different run of [STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php). The standard bash script runs [STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php) 3 times with 3 different sets of parameters. For each $Refmap line, change the name of the $popmap file after --popmap based on the name of the popmap file given in the script header.
- **[STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php) output files of note**: **gstacks.log** is a summary of the first part of the [STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php) analysis which uses the software _gstacks_. This includes: 1) total number of loci; 2) average number of sites per locus; and 3)sequencing depth statistics: 1) minimum; 2) maximum, 3) average; 4) standard deviation. The following data can be found at the end of the **gstacks.log** file as follows: **populations.log** is a summary of the second part of the [STACKS](https://catchenlab.life.illinois.edu/stacks/comp/genotypes.php) analysis which uses the software _populations_. This includes: 1) population configurations analyzed (based on the popmap file); 2) loci kept; 3) sites identified on kept loci; 4) variant sites identified on kept loci; 5) genomic sites; 6) genomic sites covered by multiple loci; 7) percent of genomic sites covered by multiple loci; 8) average genotyped sites per locus in bp; 9) samples per locus; 10) nucleotide diversity or pi; 11) all sites identified on kept loci; 12) variant sites identified on kept loci; 13) polymorphic sites identified on kept loci; and 14) private alleles. **populations.sumstats_summary.tsv** includes a lot of the info found in the **populations.log** file, as well as observed and expected hetero- and homozygosity. **populations.snps.vcf** file which will be used for downstream filtering and subsequent population structure analyses.


## WGR
Scripts and files required for the analysis of high-output sequencing data produced using whole-genome resequencing (WGR).
